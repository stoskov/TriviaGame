var trivia=trivia||{};trivia.createClass=function(e,t){var n=function(){};if(e!==null){n.prototype=e.prototype}var r=t;r.prototype=new n;r.prototype.constructor=t;return r};trivia.RestComunicator=function(e){var t=this,n=e,r={},i=5e3;t.setHostUrl=function(e){n=e};t.getHostUrl=function(){return n};t.addServiceUrl=function(e,t){r[e]=t};t.getServiceUrl=function(e,t){s(e);return r[e]};t.setTimeout=function(e){i=e};t.sendGetRequest=function(e,t,r,s,o){var u=null,a=this.getServiceUrl(e),f=n+a+t;$.support.cors=true;u=$.ajax({url:f,type:"GET",timeout:i,dataType:"json",data:r,success:s,error:o});return u};t.sendPostRequest=function(e,t,r,s,o){var u=null,a=this.getServiceUrl(e),f=n+a+t;$.support.cors=true;u=$.ajax({url:f,type:"POST",timeout:i,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(r),success:s,error:o});return u};t.parseResponseMessage=function(e){var t="";if(e&&e.statusText){t=e.statusText}if(e&&e.responseText){var n=JSON.parse(e.responseText);t=t+"\n"+n["Message"]}t=t.replace("\n","<br/>");return t};var s=function(e){if(!r||!r[e]){throw new Error("Url for service "+e+" is not defined")}}};trivia.ObservableObject=function(e){var t=this;t.getExtendedModel=function(e){var i=new trivia.ObservableObject(t);if(e&&typeof e=="object"&&e!=null){n(e,i)}r(i);return i};var n=function(e,t){if(e==null||typeof e!="object"){throw new Error("The element to copy from must be and object!")}if(t==null||typeof t!="object"){throw new Error("The element to copy from must be and object!")}for(modelProperty in e){t[modelProperty]=e[modelProperty]}};var r=function(e){if(e&&e["init"]&&e["init"]instanceof Function){e["init"].call(e)}};t.watchProperty=function(e,n,r){if(!e){throw new Error("Define the watchable property")}if(!n){throw new Error("Define the handler host")}if(!r){throw new Error("Define the handler")}if(this[e]==undefined||this[e]==null){throw new Error("The object does not contain property "+e)}var i=this[e];var s=function(){return i};var o=function(t){i=t;var n=this.observablePropertiesHandlers[e];for(var r=0;r<n.length;r++){var s=n[r];var o=s["handlerHost"];var a=s["handler"];u(o,a,t)}return t};var u=function(e,n,r){n.call(e,r,t)};if(!this["observablePropertiesHandlers"]||!this["observablePropertiesHandlers"][e]){Object.defineProperty(this,e,{get:s,set:o})}n=n||this;var a={handler:r,handlerHost:n};this["observablePropertiesHandlers"]=this["observablePropertiesHandlers"]||[];this["observablePropertiesHandlers"][e]=this["observablePropertiesHandlers"][e]||[];this.observablePropertiesHandlers[e].push(a);u(n,r,i)};n(e,t);r(t);return t};trivia.ViewModelBinder=function(e){var t=this,n=[],r={};t.bind=function(e){var t=$(e).find("[data-trivia-bind]");if($(e).data("trivia-bind")){t=t.add(e)}for(elementToBindIndex=0;elementToBindIndex<t.length;elementToBindIndex++){var r=t[elementToBindIndex];var i=s(r);o(r,i)}n.push(e)};var s=function(e){var t=$(e).data("trivia-bind")||"";var n=t.split(";");var r=[];for(i in n){var s=n[i].split(":");var o=s[0].trim();var u=s[1].trim();r[o]=u}return r};var o=function(e,t){for(bindingProperty in t){var n=t[bindingProperty];u(e,bindingProperty,n)}};var u=function(e,t,n){var i=a(t);var s=i["delegate"],o=i["arguments"],u=i["methodType"];if(!s){throw new Error("The bind type is not supported:"+t)}var l=r[n]instanceof Function;var c=f(e);if(u==="action"){if(!l){throw new Error(t+" can only be bind to action ("+r[n]+")")}if(!o[0]){throw new Error(t+" does not contain action")}var h=o[0];$(e).on(h,function(t){if(h!="keypress"&&h!="keyup"&&h!="keydown"){t.preventDefault()}r[n].call(r,c,e,t)})}else if(!l){$(e).on("change input propertyChange",function(t){t.preventDefault();r[n]=s.apply($(e),o)});r.watchProperty(n,r,function(t){o.push(t);s.apply($(e),o);o.pop()})}else{$(e).on("refresh",function(t){var i=r[n].call(r,c,e);o.push(i);s.apply($(e),o);o.pop()})}};var a=function(e){var t={};t["text"]=$().text;t["html"]=$().html;t["css"]=$().css;t["attr"]=$().attr;t["event"]=$().on;t["data"]=$().data;var n=null,r=[],i="";var s=e.split("-");if(s[0]&&t[s[0]]){n=t[s[0]]}if(s[0]==="event"){i="action"}else{i="value"}if(s[1]){r=[s[1]]}return{delegate:n,arguments:r,methodType:i}};var f=function(e){var t=$(e).data("trivia-parameters")||"";var n=t.split(";");var r=[];if(t!=""){for(i in n){var s=n[i].split(":");var o=s[0].trim();var u=s[1].trim();r[o]=u}}return r};if(e instanceof trivia.ObservableObject){r=e}else{r=new trivia.ObservableObject(e)}return t};trivia.sessionManager=new trivia.ObservableObject({store:function(e,t){var n;if(typeof Storage!=="undefined"){n=JSON.stringify(t);sessionStorage.setItem(e,n)}},retreive:function(e){var t,n={};if(typeof Storage!=="undefined"&&sessionStorage.getItem(e)!==null){t=sessionStorage.getItem(e);n=JSON.parse(t)}return n},initObject:function(e,t){var n=this.retreive(e);for(property in n){if(property!="observablePropertiesHandlers"){t[property]=n[property]}}}});trivia.Timer=function(e,t,n,r){var i=this;totalTime=e,remainingTime=e,tickInterval=t,timerHandler=null,onTickHandler=n,onTimeOverHandler=r;if(!e){throw new Error('The "time" parameter is required')}if(!t){throw new Error('The "interval" parameter is required')}i.getRemainingTime=function(){return remainingTime};i.getRemainingTimeString=function(){return remainingTime};i.toHHMMSS=function(){var e=Math.floor(remainingTime/3600);var t=Math.floor((remainingTime-e*3600)/60);var n=remainingTime-e*3600-t*60;if(e<10){e="0"+e}if(t<10){t="0"+t}if(n<10){n="0"+n}var r=e+":"+t+":"+n;return r};i.setOnTickHandler=function(e){onTickHandler=r};i.getOnTickHandler=function(){return onTickHandler};i.setOnTimeOverHandler=function(e){onTimeOverHandler=e};i.getOnTimeOverHandler=function(){return onTimeOverHandler};i.getRemainngTime=function(){return remainingTime};i.clear=function(){clearInterval(timerHandler);totalTime=0;remainingTime=0};i.pause=function(){clearInterval(timerHandler);totalTime=0;remainingTime=0};i.pause=function(){clearInterval(timerHandler);totalTime=0;remainingTime=0};i.start=function(){timerHandler=setInterval(s,tickInterval*1e3)};var s=function(){remainingTime-=tickInterval;if(onTickHandler instanceof Function&&remainingTime>0){onTickHandler.apply(i)}if(onTimeOverHandler instanceof Function&&remainingTime<=0){i.clear();onTimeOverHandler.apply(i)}};return i};(function(e){e(document).ready(function(){var t=5e5;var n=5e6;var r="never";triviaGame=window.triviaGame||{};triviaGame.restComunicator=new trivia.RestComunicator("http://trivia-game.apphb.com/api/trivia");triviaGame.restComunicator.addServiceUrl("login-user","/login-user");triviaGame.restComunicator.addServiceUrl("register-user","/register-user");triviaGame.restComunicator.addServiceUrl("user-info","/user-score");triviaGame.restComunicator.addServiceUrl("all-users","/users-all");triviaGame.restComunicator.addServiceUrl("all-categories","/categories");triviaGame.restComunicator.addServiceUrl("add-category","/add-category");triviaGame.restComunicator.addServiceUrl("start-game","/start-game");triviaGame.restComunicator.addServiceUrl("post-answers","/post-answers");triviaGame.restComunicator.addServiceUrl("add-question","/add-question");triviaGame.restComunicator.setTimeout(t);triviaGame.userAccountManager=triviaGame.userAccountManager||{};triviaGame.userAccountManager.userAccount=new trivia.ObservableObject({username:"",nickname:"",authCode:"",isLoggedIn:false,init:function(){trivia.sessionManager.initObject("triviaGame.userAccount",this)},getHashCode:function(e,t){var n=CryptoJS.SHA1(e+t);return n.toString()},login:function(e,t,n){this.username=e;this.nickname=t;this.authCode=n;this.isLoggedIn=true;trivia.sessionManager.store("triviaGame.userAccount",this)},logout:function(e,t,n){this.username="";this.nickname="";this.authCode="";this.isLoggedIn=false;trivia.sessionManager.store("triviaGame.userAccount",this)},getAuthorisationInfo:function(){var e={username:this.username,authCode:this.authCode};return e}});triviaGame.data=triviaGame.data||{};triviaGame.data.categories=new trivia.ObservableObject({loadTimeMs:0,expiryType:r,cacheTimeMs:n,data:[],forceNextLoad:false,init:function(){trivia.sessionManager.initObject("triviaGame.data.categories",this)},loadData:function(e,t,n){var r=this,i=(new Date).getTime(),s=i-this.loadTimeMs;if(this.data.length<1||this.expiryType=="time"&&s>this.cacheTimeMs||this.forceNextLoad||n){this.forceNextLoad=false;triviaGame.restComunicator.sendGetRequest("all-categories","",{},function(t){r.onLoadDataSuccess(t,e)},t)}else{e.call(this,this.data)}},onLoadDataSuccess:function(e,t){this.loadTimeMs=(new Date).getTime();this.data=e;trivia.sessionManager.store("triviaGame.data.categories",this);if(t&&t instanceof Function){t.call(this,e)}}});triviaGame.data.users=new trivia.ObservableObject({loadTimeMs:0,expiryType:r,cacheTimeMs:n,data:[],details:{},forceNextLoad:false,init:function(){trivia.sessionManager.initObject("triviaGame.data.users",this)},loadData:function(e,t,n){var r=this,i=(new Date).getTime(),s=i-this.loadTimeMs;if(this.data.length<1||this.expiryType=="time"&&s>this.cacheTimeMs||this.forceNextLoad||n){this.forceNextLoad=false;triviaGame.restComunicator.sendGetRequest("all-users","",{},function(t){r.onLoadDataSuccess(t,e)},t)}else{e.call(r,r.data)}},onLoadDataSuccess:function(e,t){this.loadTimeMs=(new Date).getTime();this.data=e;trivia.sessionManager.store("triviaGame.data.users",this);if(t&&t instanceof Function){t.call(this,e)}},loadDetails:function(e,t,n,r){var i=this,s=(new Date).getTime(),o=s-this.loadTimeMs;var u={nickname:e};if(!this.details[e]||this.details[e]==[]||o>this.cacheTimeMs||r){triviaGame.restComunicator.sendGetRequest("user-info","",u,function(n){i.onLoadDetailsSuccess(e,n,t)},n)}else{t.call(i,i.details[e])}},onLoadDetailsSuccess:function(e,t,n){this.details[e]=t;trivia.sessionManager.store("triviaGame.data.users",this);if(n&&n instanceof Function){n.call(this,t)}}});triviaGame.controllers=triviaGame.controllers||{};triviaGame.viewModelBinders=triviaGame.viewModelBinders||{};triviaGame.controllers.userAccountController=new trivia.ObservableObject({loginVisibility:"block",logoutVisibility:"none",loginFromStatusBarVisibility:"none",loginFromStatusBarMessage:"",registrationFromStatusBarVisibility:"none",registrationFromStatusBarMessage:"",lastEvent:"",currentAjaxRequest:"",username:"",nickname:"",password:"",passwordVerification:"",authCode:"",userDisplayName:"",loginFormAnchor:e("#login-form"),registrationFormAnchor:e("#registration-form"),init:function(){var e=this;triviaGame.userAccountManager.userAccount.watchProperty("isLoggedIn",this,this.updateControlerState);triviaGame.userAccountManager.userAccount.watchProperty("nickname",this,this.updateControlerState);if(!this.loginFormAnchor.data("kendoWindow")){this.loginFormAnchor.kendoWindow({title:"Login",modal:true,resizable:false,close:function(){e.cancelAjaxRequest()}});this.loginFormAnchor.data("kendoWindow").close()}if(!this.registrationFormAnchor.data("kendoWindow")){this.registrationFormAnchor.kendoWindow({title:"Registration",modal:true,resizable:false,close:function(){e.cancelAjaxRequest()}});this.registrationFormAnchor.data("kendoWindow").close()}},cancelAjaxRequest:function(){if(this.currentAjaxRequest){this.currentAjaxRequest.abort();this.currentAjaxRequest=""}},updateControlerState:function(){if(triviaGame.userAccountManager.userAccount.isLoggedIn==true){this.loginVisibility="none";this.logoutVisibility="block"}else{this.loginVisibility="block";this.logoutVisibility="none"}this.userDisplayName=triviaGame.userAccountManager.userAccount.username},clearInfo:function(){this.password="";this.passwordVerification="";this.username="";this.nickname="";this.loginFromStatusBarVisibility="none";this.registrationFromStatusBarMessage="";this.registrationFromStatusBarVisibility="none";this.loginFromStatusBarMessage="";this.currentAjaxRequest=""},handleKeyPressLogin:function(e,t,n){if(n.keyCode==13){this.sendLoginRequest()}else if(n.keyCode==27){this.closeLoginForm()}},login:function(){if(!triviaGame.userAccountManager.userAccount.isLoggedIn){this.openLoginForm()}},openLoginForm:function(){this.clearInfo();this.loginFormAnchor.data("kendoWindow").center();this.loginFormAnchor.data("kendoWindow").open()},sendLoginRequest:function(){var e=this;if(this.verifyLoginRequest()){this.authCode=triviaGame.userAccountManager.userAccount.getHashCode(this.username,this.password);var t={username:this.username,authCode:this.authCode};this.postLoginStatusMessage("Waiting response ... ");this.currentAjaxRequest=triviaGame.restComunicator.sendPostRequest("login-user","",t,function(t){e.onSuccessfullLogin(t)},function(t){e.onErrorLogin(t)})}},verifyLoginRequest:function(){if(this.username==""||this.password==""){this.loginFromStatusBarVisibility="block";this.loginFromStatusBarMessage="Username and password are required";return false}return true},onSuccessfullLogin:function(){triviaGame.userAccountManager.userAccount.login(this.username,this.nickname,this.authCode);this.lastEvent="login";this.clearInfo();this.closeLoginForm()},onErrorLogin:function(e){var t=triviaGame.restComunicator.parseResponseMessage(e);this.postLoginStatusMessage(t)},closeLoginForm:function(){this.cancelAjaxRequest();this.clearInfo();this.loginFormAnchor.data("kendoWindow").close()},logout:function(){this.lastEvent="logout";this.clearInfo();triviaGame.userAccountManager.userAccount.logout()},postLoginStatusMessage:function(e){this.loginFromStatusBarVisibility="block";this.loginFromStatusBarMessage=e},handleKeyPressRegister:function(e,t,n){if(n.keyCode==13){this.sendRegistrationRequest()}else if(n.keyCode==27){this.closeRegistrationForm()}},register:function(){if(!triviaGame.userAccountManager.userAccount.isLoggedIn){this.openRegistrationForm()}},sendRegistrationRequest:function(){var e=this;if(this.verifyRegistrationRequest()){this.authCode=triviaGame.userAccountManager.userAccount.getHashCode(this.username,this.password);var t={username:this.username,nickname:this.nickname,authCode:this.authCode};this.postRegistrationStatusMessage("Waiting response ... ");this.currentAjaxRequest=triviaGame.restComunicator.sendPostRequest("register-user","",t,function(t){e.onSuccessfullRegistration(t)},function(t){e.onErrorRegistration(t)})}},verifyRegistrationRequest:function(){if(this.username==""||this.nickname==""||this.password==""||this.passwordVerification==""){this.registrationFromStatusBarVisibility="block";this.registrationFromStatusBarMessage="All fields are required";return false}else if(this.password!==this.passwordVerification){this.registrationFromStatusBarVisibility="block";this.registrationFromStatusBarMessage="Passwords don't match";return false}return true},onSuccessfullRegistration:function(e){triviaGame.userAccountManager.userAccount.login(this.username,this.nickname,this.authCode);this.lastEvent="register";this.clearInfo();this.closeRegistrationForm()},onErrorRegistration:function(e){var t=triviaGame.restComunicator.parseResponseMessage(e);this.postRegistrationStatusMessage(t)},openRegistrationForm:function(){this.clearInfo();this.registrationFormAnchor.data("kendoWindow").center();this.registrationFormAnchor.data("kendoWindow").open()},closeRegistrationForm:function(){this.cancelAjaxRequest();this.clearInfo();this.registrationFormAnchor.data("kendoWindow").close()},postRegistrationStatusMessage:function(e){this.registrationFromStatusBarVisibility="block";this.registrationFromStatusBarMessage=e}});triviaGame.viewModelBinders.userAccountViewBinder=new trivia.ViewModelBinder(triviaGame.controllers.userAccountController);triviaGame.viewModelBinders.userAccountViewBinder.bind(e("#site-header-user-account-wrap"));triviaGame.viewModelBinders.userAccountViewBinder.bind(e("#login-form"));triviaGame.viewModelBinders.userAccountViewBinder.bind(e("#registration-form"));triviaGame.controllers.pages=triviaGame.controllers.pages||{};triviaGame.viewModelBinders.pages=triviaGame.viewModelBinders.pages||{};triviaGame.controllers.pages.mainPageModel=new trivia.ObservableObject({needLogin:false,isActivePage:false,isReload:true,isWaitingSubmitResponce:false,serviceName:"",pageName:"",pageContainer:"",pageContent:".page-content",pageMessageBoxContainer:".page-message-box",pageStatusBoxContainer:".page-status-box",pageDisplay:"none",contentDisplay:"none",messageBoxDisplay:"none",statusBoxDisplay:"none",statusBoxMessage:"",pageResponse:"",pageResponseData:{},lastEvent:"",currentAjaxRequest:"",getPageContainerDOM:function(){return e(this.pageContainer)},getPageContentDOM:function(){return this.getPageContainerDOM().find(this.pageContent)},getPageMessageBoxContainerDOM:function(){return this.getPageContainerDOM().find(this.pageMessageBoxContainer)},getPageStatusBoxContainerDOM:function(){return this.getPageContainerDOM().find(this.pageStatusBoxContainer)},init:function(){this.viewDisplay="none";if(this.needLogin){triviaGame.userAccountManager.userAccount.watchProperty("isLoggedIn",this,this.onUserLoginLogout)}triviaGame.viewModelBinders.pages.pageAddCategoryViewBinder=new trivia.ViewModelBinder(this);triviaGame.viewModelBinders.pages.pageAddCategoryViewBinder.bind(this.getPageContainerDOM());if(this.pageName){this.restorePage()}this.isWaitingSubmitResponce=false;this.isReload=true;this.statusBoxDisplay="none";this.initSpecific()},initSpecific:function(){},load:function(e){this.pageDisplay="block";this.isActivePage=true;if(!this.needLogin||triviaGame.userAccountManager.userAccount.isLoggedIn){this.renderPageMessage("Loading ...");this.loadPageData(e);this.lastEvent="load-page: "+this.pageName}else{this.renderPageMessage("Please, login to see this page!");triviaGame.controllers.userAccountController.login()}this.storePage()},loadPageData:function(e){this.renderPage()},unload:function(){this.pageDisplay="none";this.isActivePage=false;this.unloadSpecific();this.storePage()},clearPage:function(){},unloadSpecific:function(){},cancelPendingAjaxRequest:function(){if(this.currentAjaxRequest){this.currentAjaxRequest.abort();this.currentAjaxRequest=""}},onUserLoginLogout:function(){if(this.isActivePage){if(this.needLogin&&!triviaGame.userAccountManager.userAccount.isLoggedIn){this.cancelPendingAjaxRequest();this.clearPage()}this.onUserLoginLogoutSpecific();this.load()}},onUserLoginLogoutSpecific:function(){},onLoadDataSuccess:function(e){this.renderPage(e);this.isReload=false},onLoadDataError:function(e){var t=triviaGame.restComunicator.parseResponseMessage(e);this.renderPageMessage(t)},renderPage:function(e){this.displayContentBox();this.renderPageContent(e);this.updateButtonsStatusOnRefresh();this.isReload=false},renderPageContent:function(e){},requestSubmit:function(){var e;if(this.verifySubmit()){this.isWaitingSubmitResponce=true;e=this.getDOMElementsToDisable();this.disableDOMElements(e);this.submit()}},verifySubmit:function(){return true},onSubmitSuccess:function(){this.lastEvent="submit-page: "+this.pageName;this.isWaitingSubmitResponce=false;var e=this.getDOMElementsToDisable();this.enableDOMElements(e);this.clearPage();this.renderPageStatus("submited successfully!")},onSubmitError:function(e){this.isWaitingSubmitResponce=false;var t=this.getDOMElementsToDisable();this.enableDOMElements(t);var n=triviaGame.restComunicator.parseResponseMessage(e);this.renderPageStatus(n)},renderPageMessage:function(e){this.displayMessageBox();this.getPageMessageBoxContainerDOM().html(e)},renderPageStatus:function(e){this.statusBoxDisplay="block";this.statusBoxMessage=e},clearPageStatus:function(e){this.statusBoxDisplay="none";this.statusBoxMessage=""},displayMessageBox:function(){this.contentDisplay="none";this.messageBoxDisplay="block"},displayContentBox:function(){this.contentDisplay="block";this.messageBoxDisplay="none"},storePage:function(){trivia.sessionManager.store("trivia.pages."+this.pageName,this)},restorePage:function(){trivia.sessionManager.initObject("trivia.pages."+this.pageName,this)},getDOMElementsToDisable:function(){var e=this.getPageContentDOM().find("input[type='submit'], .k-button");return e},disableDOMElements:function(t){var n,r;for(n=0;n<t.length;n++){r=e(t[n]);r.attr("disabled","disabled")}},enableDOMElements:function(t){var n,r;for(n=0;n<t.length;n++){r=e(t[n]);r.removeAttr("disabled")}},updateButtonsStatusOnRefresh:function(){if(this.isWaitingSubmitResponce){e=this.getDOMElementsToDisable();this.disableDOMElements(e)}else{var e=this.getDOMElementsToDisable();this.enableDOMElements(e)}this.updateButtonsStatusOnRefreshSpecific()},updateButtonsStatusOnRefreshSpecific:function(){}});triviaGame.controllers.pages.pageAllCategoriesController=triviaGame.controllers.pages.mainPageModel.getExtendedModel({serviceName:"all-categories",pageName:"page-all-categories",pageContainer:"#page-all-categories",loadPageData:function(){var e=this;triviaGame.data.categories.loadData(function(t){e.onLoadDataSuccess(t)},function(t){e.onLoadDataError(t)})},unloadSpecific:function(){this.getPageContentDOM().find("#page-all-categories-grid").html("")},renderPageContent:function(e){this.getPageContentDOM().find("#page-all-categories-grid").kendoGrid({dataSource:{data:e,schema:{model:{fields:{id:{type:"number"},name:{type:"string"}}}}},groupable:false,sortable:{allowUnsort:true},filterable:true,pageable:{refresh:false,pageSize:10,pageSizes:[5,10,15,30,50,100]},columns:[{field:"id",width:20,title:"No",headerAttributes:{style:"text-align: center"},attributes:{style:"text-align: center"}},{field:"name",width:80,title:"Category name",headerAttributes:{style:"text-align: center"}}]})}});triviaGame.controllers.pages.pageAddCategoryController=triviaGame.controllers.pages.mainPageModel.getExtendedModel({needLogin:true,serviceName:"add-category",pageName:"page-add-category",pageContainer:"#page-add-category",categoryName:"",questionsCollection:[],questionNextId:1,minQuestionsRqiuired:10,minCorrectAnswersRqiuired:1,minWrongAnswersRqiuired:3,initSpecific:function(){var e=this;this.watchProperty("categoryName",e,function(){e.storePage()})},renderPageContent:function(e){this.buildBanelBar();if(this.isReload){this.restoreQuestions()}},buildBanelBar:function(){this.getPageContentDOM().find("#page-add-category-questions-wrap").kendoPanelBar()},requestAddQuestionElement:function(){var e=this.addQuestion();this.addQuestionElement(e);this.buildBanelBar()},addQuestion:function(){var e,t=this;e=new trivia.ObservableObject({text:"",id:this.questionNextId,correctAnswers:[],wrongAnswers:[],answerNextId:1,correctAnswersCount:0,wrongAnswersCount:0,requestAddAnswerElement:function(e,n){t.requestAddAnswerElement(this,e,n)},requestDeleteQuestionElement:function(e,n){t.requestDeleteQuestionElement(this,e,n)},updateCounters:function(){this.correctAnswersCount=this.correctAnswers.length;this.wrongAnswersCount=this.wrongAnswers.length}});e.watchProperty("text",t,function(){t.storePage()});this.questionNextId++;this.questionsCollection.push(e);this.storePage();return e},addQuestionElement:function(t){var n=e(e("#add-question-section-template").html()),r=e(e("#add-question-text-template").html()),i=e(e("#add-question-answers-section-template").html());i.find(".add-question-answers-wrap").kendoPanelBar({});n.find(".add-question-section").append(r);n.find(".add-question-section").append(i);questionViewModelBilder=new trivia.ViewModelBinder(t);questionViewModelBilder.bind(n);this.getPageContentDOM().find("#page-add-category-questions-wrap").append(n)},requestDeleteQuestionElement:function(e,t,n){var r=e.id;this.deleteQuestion(r);this.deleteQuestionElement(n)},deleteQuestion:function(e){var t=0;while(t<this.questionsCollection.length){if(this.questionsCollection[t].id==e){this.questionsCollection.splice(t,1)}else{t++}}this.storePage()},deleteQuestionElement:function(t){e(t).parents(".add-question-section-wrap").remove()},getParentDOMByQuestionId:function(t){var n,r;e(".add-question-section-wrap").each(function(){r=e(this).data("id");if(r==t){n=e(this)}});return n},requestAddAnswerElement:function(t,n,r){var i,s,o;if(n&&n["section"]){i=n["section"];s=this.addAnswer(t,i);o=e(r).parents(".add-question-section-wrap");this.addAnswerElement(s,i,o)}},addAnswer:function(e,t){var n,r=this;n=new trivia.ObservableObject({text:"",id:e.answerNextId,requestDeleteAnswerElement:function(t,n){r.requestDeleteAnswerElement(e,this,t,n)}});n.watchProperty("text",r,function(){r.storePage()});e.answerNextId++;if(t=="correntAnswers"){e.correctAnswers.push(n)}else if(t=="wrongAnswers"){e.wrongAnswers.push(n)}e.updateCounters();this.storePage();return n},addAnswerElement:function(t,n,r){var i,s=e(e("#add-question-answer-wrap-template").html());if(n=="correntAnswers"){i=r.find(".add-question-correct-answers-list")}else if(n=="wrongAnswers"){i=r.find(".add-question-wrong-answers-list")}answerViewModelBilder=new trivia.ViewModelBinder(t);answerViewModelBilder.bind(s);s.appendTo(i)},requestDeleteAnswerElement:function(t,n,r,i){var s=n.id;this.deleteAnswer(t,s);e(i).parent().remove()},deleteAnswer:function(e,t){var n=0;while(n<e.correctAnswers.length){if(e.correctAnswers[n].id==t){e.correctAnswers.splice(n,1)}else{n++}}n=0;while(n<e.wrongAnswers.length){if(e.wrongAnswers[n].id==t){e.wrongAnswers.splice(n,1)}else{n++}}this.storePage();e.updateCounters()},restoreQuestions:function(){var e=this.questionsCollection,t,n,r,i;this.questionsCollection=[];for(n=0;n<e.length;n++){t=this.addQuestion();t.id=e[n].id;t.text=e[n].text;t.answerNextId=e[n].answerNextId;this.addQuestionElement(t);this.buildBanelBar();for(r=0;r<e[n].correctAnswers.length;r++){answerModel=this.addAnswer(t,"correntAnswers");answerModel.id=e[n].correctAnswers[r].id;answerModel.text=e[n].correctAnswers[r].text;i=this.getParentDOMByQuestionId(t.id);this.addAnswerElement(answerModel,"correntAnswers",i)}for(r=0;r<e[n].wrongAnswers.length;r++){answerModel=this.addAnswer(t,"wrongAnswers");answerModel.id=e[n].wrongAnswers[r].id;answerModel.text=e[n].wrongAnswers[r].text;i=this.getParentDOMByQuestionId(t.id);this.addAnswerElement(answerModel,"wrongAnswers",i)}t.updateCounters()}},submit:function(){var e,t,n=this;e=triviaGame.userAccountManager.userAccount.getAuthorisationInfo();t={user:e,category:{name:this.categoryName,questions:this.questionsCollection}};this.renderPageStatus("waiting response ...");this.currentAjaxRequest=triviaGame.restComunicator.sendPostRequest(this.serviceName,"",t,function(e){n.onSubmitSuccess(e)},function(e){n.onSubmitError(e)})},verifySubmit:function(){var e,t,n="To submit the request: <br/>",r=true,i=false,s="";this.clearPageStatus();if(this.categoryName==""){n+="- Category must have name!";n+="<br/>"}if(this.questionsCollection.length<this.minQuestionsRqiuired){n+="- Minumum "+this.minQuestionsRqiuired+" ("+this.questionsCollection.length+") questions are required!";n+="<br/>";r=false}for(var o=0;o<this.questionsCollection.length;o++){if(this.questionsCollection[o].text==""){i=true;s="empty"}else{s=this.questionsCollection[o].text}e=this.extractNonEmptyAnswers(this.questionsCollection[o].wrongAnswers);t=this.extractNonEmptyAnswers(this.questionsCollection[o].correctAnswers);if(this.questionsCollection[o].wrongAnswers.length<this.minWrongAnswersRqiuired||this.questionsCollection[o].correctAnswers.length<this.minCorrectAnswersRqiuired){n+='- (q: "'+s+'") Minimum '+this.minCorrectAnswersRqiuired+" ("+this.questionsCollection[o].correctAnswers.length+") correnct answers ";n+="and minimum "+this.minWrongAnswersRqiuired+" ("+this.questionsCollection[o].wrongAnswers.length+") wrong answers are required!";n+="<br/>";r=false}if(e.length<this.questionsCollection[o].wrongAnswers.length||t.length<this.questionsCollection[o].correctAnswers.length){n+='- (q: "'+s+'") all answers must have text!';n+="<br/>";r=false}}if(i){n+="- All questions must have text!";n+="<br/>";r=false}if(!r){this.renderPageStatus(n);return false}else{return true}},extractNonEmptyAnswers:function(e){var t=[];for(answer in e){if(e[answer]["text"]!=""){t.push(e[answer])}}return t},clearPage:function(){this.questionsCollection=[];this.categoryName="";this.questionNextId=1;this.clearPageStatus();this.storePage();this.getPageContentDOM().find("#page-add-category-questions-wrap").html("")}});triviaGame.controllers.pages.pageAddQuestionController=triviaGame.controllers.pages.mainPageModel.getExtendedModel({needLogin:true,serviceName:"add-question",pageName:"page-add-question",pageContainer:"#page-add-question",categoryId:"",questionText:"",correctAnswersCollection:[],wrongAnswersCollection:[],answerNextId:1,correctAnswersCount:0,wrongAnswersCount:0,minCorrectAnswersRqiuired:1,minWrongAnswersRqiuired:3,initSpecific:function(){var e=this;this.watchProperty("questionText",e,function(){e.storePage()});this.watchProperty("categoryId",e,function(){e.storePage()})},loadPageData:function(e){var t=this;if(e&&e.categoryId){this.categoryId=e.categoryId}triviaGame.data.categories.loadData(function(e){t.onLoadDataSuccess(e)},function(e){t.onLoadDataError(e)})},renderPageContent:function(e){this.getPageContentDOM().find("#page-add-question-category-id").kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:e,height:400});this.categoryId=this.getPageContentDOM().find("#page-add-question-category-id").val();this.getPageContentDOM().find("#page-add-question-answers-wrap").kendoPanelBar();if(this.isReload){this.restoreAnswers()}},requestAddAnswerElement:function(e){var t,n;if(e&&e["section"]){t=e["section"];n=this.addAnswer(t);this.addAnswerElement(t,n)}},addAnswer:function(e){var t,n=this;t=new trivia.ObservableObject({text:"",id:this.answerNextId,requestDeleteAnswerElement:function(e,t){n.requestDeleteAnswerElement(this,e,t)}});t.watchProperty("text",n,function(){n.storePage()});this.answerNextId++;if(e=="correntAnswers"){this.correctAnswersCollection.push(t)}else if(e=="wrongAnswers"){this.wrongAnswersCollection.push(t)}this.updateCounters();this.storePage();return t},addAnswerElement:function(t,n){var r=e(e("#add-question-answer-wrap-template").html()),i;if(t=="correntAnswers"){i=this.getPageContentDOM().find(".add-question-correct-answers-list")}else if(t=="wrongAnswers"){i=this.getPageContentDOM().find(".add-question-wrong-answers-list")}answerViewModelBilder=new trivia.ViewModelBinder(n);answerViewModelBilder.bind(r);r.appendTo(i)},requestDeleteAnswerElement:function(t,n,r){var i=t.id;this.deleteAnswer(i);e(r).parent().remove()},deleteAnswer:function(e){var t=0;while(t<this.correctAnswersCollection.length){if(this.correctAnswersCollection[t].id==e){this.correctAnswersCollection.splice(t,1)}else{t++}}t=0;while(t<this.wrongAnswersCollection.length){if(this.wrongAnswersCollection[t].id==e){this.wrongAnswersCollection.splice(t,1)}else{t++}}this.storePage();this.updateCounters()},updateCounters:function(){this.correctAnswersCount=this.correctAnswersCollection.length;this.wrongAnswersCount=this.wrongAnswersCollection.length},restoreAnswers:function(){var e=this.correctAnswersCollection,t=this.wrongAnswersCollection,n,r;this.correctAnswersCollection=[];this.wrongAnswersCollection=[];for(r=0;r<e.length;r++){n=this.addAnswer("correntAnswers");n.id=e[r].id;n.text=e[r].text;this.addAnswerElement("correntAnswers",n)}for(r=0;r<t.length;r++){n=this.addAnswer("wrongAnswers");n.id=t[r].id;n.text=t[r].text;this.addAnswerElement("wrongAnswers",n)}},submit:function(){var e,t,n,r,i,s=this;e=this.extractNonEmptyAnswers(this.wrongAnswersCollection);t=this.extractNonEmptyAnswers(this.correctAnswersCollection);n=triviaGame.userAccountManager.userAccount.getAuthorisationInfo();r={user:n,question:{text:this.questionText,correctAnswers:t,wrongAnswers:e}};i="/"+this.categoryId;this.renderPageStatus("waiting response ...");this.currentAjaxRequest=triviaGame.restComunicator.sendPostRequest(this.serviceName,i,r,function(e){s.onSubmitSuccess(e)},function(e){s.onSubmitError(e)})},verifySubmit:function(){var e,t,n="";this.clearPageStatus();e=this.extractNonEmptyAnswers(this.wrongAnswersCollection);t=this.extractNonEmptyAnswers(this.correctAnswersCollection);if(e.length<this.minWrongAnswersRqiuired||t.length<this.minCorrectAnswersRqiuired){n="To submit the request minimum "+this.minCorrectAnswersRqiuired+" ("+t.length+") correnct answers ";n+="and minimum "+this.minWrongAnswersRqiuired+" ("+e.length+") wrong answers are required";n+="<br/>"}if(this.questionText==""){n+="the questsion text cannot be empty"}if(n!=""){this.renderPageStatus(n);return false}else{return true}},extractNonEmptyAnswers:function(e){var t=[];for(answer in e){if(e[answer]["text"]!=""){t.push(e[answer])}}return t},clearPage:function(){this.correctAnswersCollection=[];this.wrongAnswersCollection=[];this.questionText="";this.wrongAnswersCount=0;this.correctAnswersCount=0;this.answerNextId=1;this.clearPageStatus();this.storePage();this.getPageContentDOM().find(".add-question-correct-answers-list").find(".add-question-answer-wrap").each(function(){e(this).remove()});this.getPageContentDOM().find(".add-question-wrong-answers-list").find(".add-question-answer-wrap").each(function(){e(this).remove()})}});triviaGame.controllers.pages.pageAllUsersController=triviaGame.controllers.pages.mainPageModel.getExtendedModel({serviceName:"all-users",pageName:"page-all-users",pageContainer:"#page-all-users",loadPageData:function(){var e=this;triviaGame.data.users.loadData(function(t){e.onLoadDataSuccess(t)},function(t){e.onLoadDataError(t)})},unloadSpecific:function(){this.getPageContentDOM().find("#page-all-users-grid").html("")},renderPageContent:function(e){var t=this;this.getPageContentDOM().find("#page-all-users-grid").kendoGrid({dataSource:{data:e,schema:{model:{fields:{nickname:{type:"string"},score:{type:"number"},games:{type:"number"}}}}},groupable:false,sortable:{allowUnsort:true},filterable:true,pageable:{refresh:false,pageSize:10,pageSizes:[5,10,15,30,50,100]},detailInit:function(e){t.loadDetails(e)},columns:[{field:"nickname",title:"Nickname",headerAttributes:{style:"text-align: center"}},{field:"score",title:"Average score",format:"{0:0.00}",headerAttributes:{style:"text-align: center"},attributes:{style:"text-align: center"}},{field:"games",title:"Played games",headerAttributes:{style:"text-align: center"},attributes:{style:"text-align: center"}}]})},loadDetails:function(e){var t=this;triviaGame.data.users.loadDetails(e.data.nickname,function(n){t.renderDetailsGrid(e,n.categoryScores)},function(n){var r=triviaGame.restComunicator.parseResponseMessage(n);t.renderDetailsMessage(e,r)})},renderDetailsGrid:function(t,n){e("<div/>").appendTo(t.detailCell).kendoGrid({dataSource:n,groupable:false,sortable:{allowUnsort:true},filterable:true,pageable:{refresh:false,pageSize:5,pageSizes:[5,10,15,30,50,100]},columns:[{field:"category",width:50,title:"Category",headerAttributes:{style:"text-align: center"}},{field:"score",width:25,title:"Average score",format:"{0:0.00}",headerAttributes:{style:"text-align: center"},attributes:{style:"text-align: center"}},{field:"gamesPlayed",width:25,title:"Played games",headerAttributes:{style:"text-align: center"},attributes:{style:"text-align: center"}}]})},renderDetailsMessage:function(t,n){e("<div class='message-box'/>").appendTo(t.detailCell).html(n)}});triviaGame.controllers.pages.pageNewGameController=triviaGame.controllers.pages.mainPageModel.getExtendedModel({needLogin:true,serviceNameStartGame:"start-game",serviceNameCompleteGame:"post-answers",pageName:"page-new-game",pageContainer:"#page-new-game",timerContainer:"#page-new-game-float-timer",timerVisibility:"none",categoryId:"",totalTime:300,remainingTime:300,remainingTimeString:"00:00:00",isGameActive:false,timer:null,gameId:"",questionsCollection:[],answersCollection:{},initSpecific:function(){var e=this;this.watchProperty("categoryId",e,function(){e.storePage()});this.updateInavtiveGameButtonsStatus()},disableNewGameButton:function(){var e=this.getPageContentDOM().find("#page-new-game-start-game");this.disableDOMElements(e)},enableNewGameButton:function(){var e=this.getPageContentDOM().find("#page-new-game-start-game");this.enableDOMElements(e)},disableSubmitGameButton:function(){var e=this.getPageContentDOM().find("#page-new-game-submit-game");this.disableDOMElements(e)},enableSubmitGameButton:function(){var e=this.getPageContentDOM().find("#page-new-game-submit-game");this.enableDOMElements(e)},updateAvtiveGameButtonsStatus:function(){this.enableSubmitGameButton();this.disableNewGameButton()},updateInavtiveGameButtonsStatus:function(){this.disableSubmitGameButton();this.enableNewGameButton()},updateButtonsStatusOnRefreshSpecific:function(){if(!this.isWaitingSubmitResponce){if(this.isGameActive){this.updateAvtiveGameButtonsStatus()}else{this.updateInavtiveGameButtonsStatus()}}},loadPageData:function(e){var t=this;if(e&&e.categoryId){this.categoryId=e.categoryId}triviaGame.data.categories.loadData(function(e){t.onLoadDataSuccess(e)},function(e){t.onLoadDataError(e)})},renderPageContent:function(e){this.getPageContentDOM().find("#page-new-game-category-id").kendoDropDownList({dataTextField:"name",dataValueField:"id",optionLabel:{name:"<Random category>",id:"-1"},dataSource:e,height:400});if(this.isReload){this.restoreQuestions()}if(this.isGameActive&&this.isReload){this.startTimer()}},requestStartNewGame:function(){var e="",t,n=this,r=triviaGame.userAccountManager.userAccount.getAuthorisationInfo();if(this.categoryId!=-1){e="/"+this.categoryId}t=this.getDOMElementsToDisable();this.disableDOMElements(t);this.renderPageStatus("waiting response ...");this.isWaitingSubmitResponce=true;this.currentAjaxRequest=triviaGame.restComunicator.sendPostRequest(this.serviceNameStartGame,e,r,function(e){n.startNewGame(e)},function(e){n.onRequestError(e)})},startNewGame:function(e){this.clearPage();this.lastEvent="start-game: "+this.pageName;this.isWaitingSubmitResponce=false;this.isGameActive=true;this.gameId=e.id;this.questionsCollection=e.questions;this.renderQuestions(this.questionsCollection);this.updateAvtiveGameButtonsStatus();this.startTimer();this.storePage()},renderQuestions:function(e){var t,n,r,i;for(var s=0;s<e.length;s++){t=this.addQuestion(e[s]);n=this.addQuestionElement(t);r=e[s].answers;for(var o=0;o<r.length;o++){i=this.addAnswer(t,r[o]);this.addAnswerElement(n,i)}}this.getPageContentDOM().find("#page-new-game-questions-wrap").kendoPanelBar()},addQuestion:function(e){var t;t=new trivia.ObservableObject({questionText:e.text,questionId:e.id,answersList:[]});return t},addQuestionElement:function(t){var n=e(e("#game-question-template").html());questionViewModelBilder=new trivia.ViewModelBinder(t);questionViewModelBilder.bind(n);this.getPageContentDOM().find("#page-new-game-questions-wrap").append(n);return n},addAnswer:function(e,t){var n=this,r=false;if(this.answersCollection&&this.answersCollection[e.questionId]&&this.answersCollection[e.questionId]==t.id){r=true}answerModel=new trivia.ObservableObject({answerText:t.text,answerId:t.id,checked:r,answerGroup:e.questionId,questionId:e.questionId});answerModel.watchProperty("checked",n,function(e,t){if(e=="checked"){n.selectAnswer(t)}});e.answersList.push(answerModel);return answerModel},addAnswerElement:function(t,n){var r=e(e("#game-question-answer-template").html());answerViewModelBilder=new trivia.ViewModelBinder(n);answerViewModelBilder.bind(r);t.find(".game-question-asnwers-wrap").append(r);return r},onRequestError:function(e){this.isWaitingSubmitResponce=false;this.updateButtonsStatusOnRefreshSpecific();var t=triviaGame.restComunicator.parseResponseMessage(e);this.renderPageStatus(t)},selectAnswer:function(e){this.answersCollection[e.questionId]=e.answerId;this.storePage()},restoreQuestions:function(){this.renderQuestions(this.questionsCollection)},submit:function(){var e,t,n,r=this;e=this.getAnwersList();t=triviaGame.userAccountManager.userAccount.getAuthorisationInfo();n={user:t,questions:e};this.renderPageStatus("waiting response ...");this.currentAjaxRequest=triviaGame.restComunicator.sendPostRequest(this.serviceNameCompleteGame,"/"+this.gameId,n,function(e){r.onSubmitSuccess(e)},function(e){r.onSubmitError(e)})},getAnwersList:function(){var e=[];for(question in this.answersCollection){e.push({questionId:question,answerId:this.answersCollection[question]})}return e},startTimer:function(){var e=this;this.timer=new trivia.Timer(this.remainingTime,1,function(){e.onTimerTick()},function(){e.onTimerOver()});this.remainingTimeString=this.timer.toHHMMSS();this.timer.start();this.showTimer()},stopTimer:function(){if(this.timer!=null){this.hideTimer();this.timer.clear()}},onTimerTick:function(){this.remainingTimeString=this.timer.toHHMMSS();this.remainingTime=this.timer.getRemainngTime();this.storePage()},onTimerOver:function(){this.remainingTimeString="Time over!";this.updateInavtiveGameButtonsStatus();this.isGameActive=false;this.stopTimer();this.storePage()},showTimer:function(){this.timerVisibility="block"},hideTimer:function(){this.timerVisibility="none"},clearPage:function(){this.questionsCollection=[];this.answersCollection={};this.gameId="";this.categoryId="";this.isGameActive=false;this.remainingTime=this.totalTime;this.remainingTimeString="00:00:00";this.clearPageStatus();this.updateInavtiveGameButtonsStatus();this.stopTimer();this.storePage();this.getPageContentDOM().find("#page-new-game-questions-wrap").html("")}});triviaGame.controllers.pages.pageAboutController=triviaGame.controllers.pages.mainPageModel.getExtendedModel({pageName:"page-about",pageContainer:"#page-about"});triviaGame.controllers.navigationController=new trivia.ObservableObject({pageControllersMap:[],activePage:null,startPageName:"page-all-categories",init:function(){var t,n;e("#site-main-nav").kendoMenu();this.addPage(triviaGame.controllers.pages.pageAllCategoriesController.pageName,triviaGame.controllers.pages.pageAllCategoriesController);this.addPage(triviaGame.controllers.pages.pageAllUsersController.pageName,triviaGame.controllers.pages.pageAllUsersController);this.addPage(triviaGame.controllers.pages.pageAddCategoryController.pageName,triviaGame.controllers.pages.pageAddCategoryController);this.addPage(triviaGame.controllers.pages.pageAddQuestionController.pageName,triviaGame.controllers.pages.pageAddQuestionController);this.addPage(triviaGame.controllers.pages.pageNewGameController.pageName,triviaGame.controllers.pages.pageNewGameController);this.addPage(triviaGame.controllers.pages.pageAboutController.pageName,triviaGame.controllers.pages.pageAboutController);triviaGame.viewModelBinders.navigationViewBinder=new trivia.ViewModelBinder(this);triviaGame.viewModelBinders.navigationViewBinder.bind(e("#site-main-nav"));for(t in this.pageControllersMap){if(this.pageControllersMap[t].isActivePage){n=true;break}}if(n){this.changeActivePage(this.pageControllersMap[t].pageName,{})}else{this.changeActivePage(this.startPageName,{})}},addPage:function(e,t){this.pageControllersMap[e]=t;t.watchProperty("pageResponse",this,this.onPageResponse)},requestPageChange:function(e){if(e&&e["pageName"]){var t=e["pageName"];this.changeActivePage(t,{})}},changeActivePage:function(e,t){if(this.activePage!=null&&this.activePage!=undefined){this.activePage.unload(t)}if(e!=undefined&&e!=null){this.activePage=this.pageControllersMap[e];this.activePage.load(t)}},onPageResponse:function(e){if(e){var t=e.split(":"),n=t[0].trim(),r=t[1].trim(),e=this.activePage.pageResponseData;switch(n){case"redirect":this.changeActivePage(r,e);break}}}});triviaGame.notificator=new trivia.ObservableObject({eventHandlers:[],pubnubAnchor:null,init:function(){var e=this;PUBNUB=window.PUBNUB||"";if(PUBNUB){this.pubnubAnchor=PUBNUB.init({publish_key:"pub-c-a0fb260f-0775-4a00-b5fb-c5d35f82347f",subscribe_key:"sub-c-ae182494-7a0e-11e2-89a1-12313f022c90"});this.pubnubAnchor.subscribe({channel:"trivia-game",message:function(t){e.treatEvent(t)}});this.eventHandlers["login"]=function(t,n){e.logMessage("User "+t+" just logged in")};this.eventHandlers["logout"]=function(t,n){e.logMessage("User "+t+" just logged out")};this.eventHandlers["register"]=function(t,n){e.logMessage("User "+t+" just registered");triviaGame.data.users.forceNextLoad=true};this.eventHandlers["start-game"]=function(t,n){e.logMessage("User "+t+" just started new game")};this.eventHandlers["submit-page"]=function(t,n){if(n.indexOf("page-add-category")>=0){e.logMessage("User "+t+" just started a new game");triviaGame.data.categories.forceNextLoad=true}else if(n.indexOf("page-new-game")>=0){e.logMessage("User "+t+" just completed a game");triviaGame.data.users.forceNextLoad=true}};this.follow(triviaGame.controllers.userAccountController);this.follow(triviaGame.controllers.pages.pageAllCategoriesController);this.follow(triviaGame.controllers.pages.pageAllUsersController);this.follow(triviaGame.controllers.pages.pageAddCategoryController);this.follow(triviaGame.controllers.pages.pageAddQuestionController);this.follow(triviaGame.controllers.pages.pageNewGameController)}},follow:function(e){var t=this;if(e["lastEvent"]!=undefined){e.watchProperty("lastEvent",t,function(e,t){var n="anonymous";if(triviaGame.userAccountManager.userAccount.isLoggedIn){n=triviaGame.userAccountManager.userAccount.username}this.broadcastEvent(n,e,new Date)})}},broadcastEvent:function(e,t,n){var r=JSON.stringify({user:e,event:t,time:n});this.pubnubAnchor.publish({channel:"trivia-game",message:r})},treatEvent:function(e){var t=JSON.parse(e);eventDetails=t["event"].split(":");if(this.eventHandlers[eventDetails[0]]){this.eventHandlers[eventDetails[0]].call(this,t["user"],eventDetails[1])}},logMessage:function(t){e("#event-logger").text(t)}})})})(jQuery)